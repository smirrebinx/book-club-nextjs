# Claude Development Guidelines - Barnfria Bokklubben

This document outlines the development guidelines for the Barnfria Bokklubben (Swedish Book Club) application, built with React, TypeScript, Next.js 15, Tailwind CSS, MongoDB, and NextAuth.js.

## Table of Contents

1. [Project Overview](#project-overview)
2. [Tech Stack & Architecture](#tech-stack--architecture)
3. [Project Structure](#project-structure)
4. [Database Models](#database-models)
5. [Authentication & Authorization](#authentication--authorization)
6. [React Best Practices](#react-best-practices)
7. [TypeScript Guidelines](#typescript-guidelines)
8. [Next.js Patterns](#nextjs-patterns)
9. [Styling: Tailwind CSS & CSS Variables](#styling-tailwind-css--css-variables)
10. [Component Patterns](#component-patterns)
11. [WCAG Accessibility Standards](#wcag-accessibility-standards)
12. [Performance Optimization](#performance-optimization)
13. [Environment Variables](#environment-variables)
14. [Deployment](#deployment)

---

## Project Overview

**Barnfria Bokklubben** is a Swedish book club application that enables members to:
- Suggest books for the club to read
- Vote on suggested books
- View upcoming meetings and meeting history
- Admin dashboard for managing users, suggestions, and meetings

**Key Features:**
- Role-based access control (pending/user/admin)
- Google OAuth authentication
- Book suggestion and voting system
- Meeting management
- Google Books API integration for book metadata
- WCAG AAA compliant design with sage green brand palette

---

## Tech Stack & Architecture

### Core Technologies
- **Framework:** Next.js 15.0.0 (App Router)
- **React:** 19.0.0
- **TypeScript:** 5.x
- **Database:** MongoDB with Mongoose 8.19.2
- **Authentication:** NextAuth.js 5.0.0-beta.30
- **Styling:** Tailwind CSS 4.1.16 with CSS Variables
- **Validation:** Zod 4.1.12
- **Deployment:** Netlify

### External APIs
- Google Books API (book metadata, cover images)
- Google OAuth (authentication)

---

## Project Structure

```
book-club-nextjs/
├── frontend/                         # Main application directory
│   ├── src/
│   │   ├── app/                      # Next.js App Router
│   │   │   ├── api/                  # API Routes
│   │   │   │   ├── admin/
│   │   │   │   │   ├── pending-count/route.ts
│   │   │   │   │   └── users/route.ts
│   │   │   │   ├── auth/
│   │   │   │   │   └── [...nextauth]/route.ts
│   │   │   │   ├── books/route.ts
│   │   │   │   ├── meetings/
│   │   │   │   │   ├── route.ts
│   │   │   │   │   ├── [id]/route.ts
│   │   │   │   │   └── next/route.ts
│   │   │   │   └── suggestions/route.ts
│   │   │   ├── admin/                # Admin Pages (protected)
│   │   │   │   ├── meetings/page.tsx
│   │   │   │   ├── suggestions/page.tsx
│   │   │   │   ├── users/page.tsx
│   │   │   │   ├── layout.tsx
│   │   │   │   ├── actions.ts
│   │   │   │   └── AdminMobileNav.tsx
│   │   │   ├── auth/                 # Authentication Pages
│   │   │   │   ├── signin/page.tsx
│   │   │   │   └── pending/page.tsx
│   │   │   ├── BooksRead/page.tsx    # Books read history
│   │   │   ├── NextMeeting/page.tsx  # Next meeting details
│   │   │   ├── Vote/page.tsx         # Vote on suggestions
│   │   │   ├── suggestions/page.tsx  # Suggest books
│   │   │   ├── globals.css           # Global styles + CSS variables
│   │   │   ├── layout.tsx            # Root layout
│   │   │   ├── page.tsx              # Home page
│   │   │   └── icon.svg
│   │   │
│   │   ├── components/               # React Components
│   │   │   ├── navbar/
│   │   │   │   ├── DesktopNav.tsx
│   │   │   │   ├── MobileNav.tsx
│   │   │   │   ├── Logo.tsx
│   │   │   │   ├── MobileMenuButton.tsx
│   │   │   │   └── MobileUserAvatar.tsx
│   │   │   ├── Navbar.tsx
│   │   │   ├── ActionButton.tsx      # Success/danger/warning buttons
│   │   │   ├── AdminOnly.tsx         # Auth wrapper for admin content
│   │   │   ├── ApprovedOnly.tsx      # Auth wrapper for approved users
│   │   │   ├── AutoRefresh.tsx
│   │   │   ├── BookPlaceholder.tsx
│   │   │   ├── BookSearchInput.tsx
│   │   │   ├── Button.tsx            # Primary UI button
│   │   │   ├── ConfirmModal.tsx
│   │   │   ├── GdprInfoModal.tsx
│   │   │   ├── LoadingSkeleton.tsx
│   │   │   ├── LottieAnimation.tsx
│   │   │   ├── MeetingCard.tsx
│   │   │   ├── NextMeetingCard.tsx
│   │   │   ├── SessionProviderWrapper.tsx
│   │   │   ├── StatCard.tsx
│   │   │   ├── StatusBadge.tsx
│   │   │   └── Toast.tsx
│   │   │
│   │   ├── lib/                      # Utilities & Library Code
│   │   │   ├── auth.ts               # NextAuth configuration
│   │   │   ├── auth.config.ts        # Edge-compatible auth config
│   │   │   ├── auth-helpers.ts       # Auth utility functions
│   │   │   ├── logger.ts             # Server-side logging
│   │   │   ├── mongodb.ts            # Mongoose connection
│   │   │   ├── mongodb-client.ts     # MongoDB native client
│   │   │   ├── rateLimit.ts          # Rate limiting middleware
│   │   │   └── validations/          # Zod validation schemas
│   │   │       ├── admin.ts
│   │   │       ├── meetings.ts
│   │   │       └── suggestions.ts
│   │   │
│   │   ├── models/                   # Mongoose Models
│   │   │   ├── User.ts               # User model
│   │   │   ├── Meeting.ts            # Meeting model
│   │   │   └── BookSuggestion.ts     # Book suggestion model
│   │   │
│   │   ├── types/                    # TypeScript Type Definitions
│   │   │   ├── admin.ts
│   │   │   ├── auth.ts
│   │   │   ├── meeting.ts
│   │   │   ├── suggestion.ts
│   │   │   └── next-auth.d.ts        # NextAuth type extensions
│   │   │
│   │   ├── hooks/                    # Custom React Hooks
│   │   │   ├── usePendingCount.ts    # Hook for pending user count
│   │   │   ├── useFuzzySearch.ts     # Fuzzy search hook with fuse.js
│   │   │   └── __tests__/
│   │   │       └── useFuzzySearch.test.ts
│   │   │
│   │   ├── data/                     # Static Data Files
│   │   │   ├── booksRead.ts
│   │   │   └── nextMeeting.ts
│   │   │
│   │   ├── scripts/                  # Utility Scripts
│   │   │   └── seedMeetings.ts
│   │   │
│   │   ├── middleware.ts             # Next.js Middleware
│   │   └── constants.ts
│   │
│   ├── public/                       # Static Assets
│   │   ├── animations/               # Lottie animations
│   │   └── fonts/
│   │       └── NewYorker/
│   │           └── NewYorker.ttf
│   │
│   ├── package.json
│   ├── tsconfig.json
│   ├── next.config.ts
│   ├── tailwind.config.js
│   ├── eslint.config.mjs
│   └── .env.local
│
├── .claude.md                        # This file
├── netlify.toml                      # Netlify deployment config
└── README.md
```

---

## Database Models

### User Model (Authentication & Authorization)

```typescript
// src/models/User.ts
import mongoose, { Schema } from 'mongoose';

export type UserRole = 'pending' | 'user' | 'admin';

export interface IUser {
  name?: string;
  email: string;
  emailVerified?: Date;
  image?: string;
  role: UserRole;
  isApproved: boolean;
  forcedLogoutAt?: Date;
  createdAt?: Date;
  updatedAt?: Date;
}

const UserSchema = new Schema<IUser>(
  {
    name: { type: String },
    email: {
      type: String,
      required: true,
      unique: true,
      lowercase: true,
      trim: true
    },
    emailVerified: { type: Date },
    image: { type: String },
    role: {
      type: String,
      enum: ['pending', 'user', 'admin'],
      default: 'pending',
      required: true
    },
    isApproved: {
      type: Boolean,
      default: false,
      required: true
    },
    forcedLogoutAt: { type: Date }
  },
  { timestamps: true }
);

// Indexes for efficient queries
UserSchema.index({ role: 1 });
UserSchema.index({ isApproved: 1 });
UserSchema.index({ email: 1, role: 1 });
```

**User Flow:**
1. User signs in with Google OAuth → role: 'pending', isApproved: false
2. User sees "waiting for approval" page (`/auth/pending`)
3. Admin approves user → role: 'user', isApproved: true
4. Admin can promote to admin → role: 'admin'

### BookSuggestion Model (Voting System)

```typescript
// src/models/BookSuggestion.ts
export type SuggestionStatus = 'pending' | 'approved' | 'currently_reading' | 'rejected' | 'read';

export interface IBookSuggestion {
  title: string;
  author: string;
  description: string;
  googleDescription?: string;
  suggestedBy: Types.ObjectId;          // Reference to User
  votes: Types.ObjectId[];               // Array of User IDs who voted
  status: SuggestionStatus;
  isbn?: string;
  coverImage?: string;
  googleBooksId?: string;
  createdAt?: Date;
  updatedAt?: Date;
}
```

**Key Features:**
- Users can vote/unvote on suggestions
- Admin can approve/reject/change status
- Google Books API integration for cover images and descriptions
- Voting is tracked by User ID (one vote per user per suggestion)

### Meeting Model

```typescript
// src/models/Meeting.ts
export interface BookInfo {
  id?: string;
  title?: string;
  author?: string;
  coverImage?: string;
  isbn?: string;
}

export interface MeetingData {
  id?: string;
  date?: string;
  time?: string;
  location?: string;
  book?: BookInfo;
  additionalInfo?: string;
  createdAt?: Date;
  updatedAt?: Date;
}
```

---

## Authentication & Authorization

### NextAuth.js Configuration

**Authentication Flow:**
```typescript
// src/lib/auth.config.ts (Edge-compatible for middleware)
export const authConfig: NextAuthConfig = {
  pages: {
    signIn: "/auth/signin",
  },
  callbacks: {
    authorized({ auth, request: { nextUrl } }) {
      const isLoggedIn = !!auth?.user;
      const isOnSignIn = nextUrl.pathname.startsWith("/auth/signin");
      const isOnAdmin = nextUrl.pathname.startsWith("/admin");

      // Redirect authenticated users away from signin page
      if (isOnSignIn && isLoggedIn) {
        return Response.redirect(new URL("/", nextUrl));
      }

      // Require authentication for all pages except signin
      if (!isLoggedIn && !isOnSignIn) {
        return false;
      }

      return true;
    },
  },
  providers: [], // Providers added in auth.ts
};
```

**Full Auth Configuration:**
```typescript
// src/lib/auth.ts
import NextAuth from 'next-auth';
import Google from 'next-auth/providers/google';
import { MongoDBAdapter } from '@auth/mongodb-adapter';

export const { handlers, signIn, signOut, auth } = NextAuth({
  adapter: MongoDBAdapter(clientPromise),
  providers: [
    Google({
      clientId: process.env.GOOGLE_CLIENT_ID,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET,
    }),
  ],
  callbacks: {
    async session({ session, user }) {
      // Fetch user role from database
      const dbUser = await User.findOne({ email: user.email });
      session.user.role = dbUser?.role || 'pending';
      session.user.isApproved = dbUser?.isApproved || false;
      return session;
    },
  },
});
```

### Authorization Patterns

**Component-Level Authorization:**
```typescript
// src/components/AdminOnly.tsx
export function AdminOnly({ children }: { children: React.ReactNode }) {
  const session = useSession();

  if (session?.user?.role !== 'admin') {
    return null;
  }

  return <>{children}</>;
}

// Usage
<AdminOnly>
  <button onClick={deleteUser}>Delete User</button>
</AdminOnly>
```

**Server-Side Authorization:**
```typescript
// src/app/api/admin/users/route.ts
import { auth } from '@/lib/auth';

export async function GET() {
  const session = await auth();

  if (!session?.user || session.user.role !== 'admin') {
    return NextResponse.json(
      { error: 'Unauthorized' },
      { status: 403 }
    );
  }

  // Admin logic here
}
```

---

## React Best Practices

### Component Structure

```typescript
// Good: Functional component with clear props interface
interface ButtonProps {
  children: React.ReactNode;
  onClick: () => void;
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  disabled?: boolean;
  fullWidth?: boolean;
}

export function Button({
  children,
  onClick,
  variant = 'primary',
  size = 'md',
  disabled = false,
  fullWidth = false
}: ButtonProps) {
  return (
    <button
      onClick={onClick}
      disabled={disabled}
      className={`btn btn--${variant} btn--${size} ${fullWidth ? 'w-full' : ''}`}
      aria-disabled={disabled}
    >
      {children}
    </button>
  );
}
```

### Hooks Guidelines

- **Keep hooks at the top level** - Never call hooks inside loops, conditions, or nested functions
- **Custom hooks naming** - Always prefix with `use` (e.g., `usePendingCount`, `useFuzzySearch`)
- **Dependency arrays** - Be explicit about all dependencies in useEffect, useMemo, and useCallback

```typescript
// Good: Clear dependencies
useEffect(() => {
  fetchBooks(userId);
}, [userId]); // userId explicitly listed

// Bad: Missing dependencies
useEffect(() => {
  fetchBooks(userId);
}, []); // userId should be listed
```

### Custom Hook Example: Fuzzy Search

```typescript
// src/hooks/useFuzzySearch.ts
import Fuse from 'fuse.js';
import { useMemo, useState } from 'react';

export function useFuzzySearch<T>({
  data,
  keys,
  threshold = 0.4,
  minQueryLength = 1,
}: {
  data: T[];
  keys: string[];
  threshold?: number;
  minQueryLength?: number;
}) {
  const [query, setQueryInternal] = useState('');

  // Initialize Fuse with memoization
  const fuse = useMemo(() => {
    return new Fuse(data, {
      keys,
      threshold,
      ignoreLocation: true,
      findAllMatches: true,
      distance: 100,
      isCaseSensitive: false,
    });
  }, [data, keys, threshold]);

  // Validate and set query (max 100 chars, trimmed)
  const setQuery = (newQuery: string) => {
    const validated = newQuery.trim().substring(0, 100);
    setQueryInternal(validated);
  };

  // Compute filtered results
  const results = useMemo(() => {
    const trimmedQuery = query.trim();
    if (trimmedQuery.length < minQueryLength) {
      return data;
    }
    const searchResults = fuse.search(trimmedQuery);
    return searchResults.map(result => result.item);
  }, [query, fuse, data, minQueryLength]);

  const isSearching = query.trim().length >= minQueryLength;

  return { results, query, setQuery, isSearching };
}

// Usage in components
function BookList({ books }: { books: Book[] }) {
  const { results, query, setQuery, isSearching } = useFuzzySearch({
    data: books,
    keys: ['title', 'author', 'description'],
    threshold: 0.4, // More lenient for typos
  });

  return (
    <div>
      <input
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder="Search books..."
        maxLength={100}
      />
      {isSearching && <p>Showing {results.length} of {books.length}</p>}
      {results.map(book => <BookCard key={book.id} book={book} />)}
    </div>
  );
}
```

**Key Features:**
- **Input validation**: Max 100 characters, trimmed
- **Memoization**: Fuse instance and results are memoized for performance
- **Type-safe**: Generic type parameter for flexible data types
- **Configurable**: Threshold, keys, and minimum query length
- **Typo-tolerant**: Uses Fuse.js with threshold 0.4 for fuzzy matching

### State Management

```typescript
// Good: Derived state instead of duplicating
function BookList({ books }: { books: Book[] }) {
  const publishedBooks = books.filter(book => book.status === 'approved');
  // Don't create separate state for filtered data
}

// Good: Single source of truth
const [formData, setFormData] = useState({
  title: '',
  author: '',
  description: ''
});

// Bad: Multiple related states
const [title, setTitle] = useState('');
const [author, setAuthor] = useState('');
const [description, setDescription] = useState('');
```

### Event Handlers

```typescript
// Good: Descriptive names with 'handle' prefix
const handleSubmit = (e: React.FormEvent) => {
  e.preventDefault();
  // logic here
};

const handleVoteClick = (bookId: string) => {
  // logic here
};

const handleApproveUser = async (userId: string) => {
  // logic here
};
```

---

## TypeScript Guidelines

### Type Safety

```typescript
// Good: Explicit types for function parameters and returns
function calculateVotes(votes: string[]): number {
  return votes.length;
}

// Good: Interface for database models (exported from models/)
import type { IUser, IBookSuggestion, IBookSuggestion } from '@/models';

// Good: Type for API responses
type ApiResponse<T> = {
  data?: T;
  error?: string;
  status: number;
};
```

### Avoid `any`

```typescript
// Bad
function processData(data: any) {
  return data.value;
}

// Good: Use specific types
function processData(data: { value: string }) {
  return data.value;
}

// Good: Use generics when needed
function processData<T extends { value: string }>(data: T) {
  return data.value;
}
```

### Type Utilities

```typescript
// Use built-in utility types
type PartialBook = Partial<IBookSuggestion>; // All properties optional
type ReadonlyBook = Readonly<IBookSuggestion>; // All properties readonly
type BookTitleOnly = Pick<IBookSuggestion, 'title' | 'author'>; // Pick specific
type BookWithoutId = Omit<IBookSuggestion, '_id'>; // Omit specific
```

### Enums vs Union Types

```typescript
// Good: Use union types for simple cases (as used in this project)
type UserRole = 'pending' | 'user' | 'admin';
type SuggestionStatus = 'pending' | 'approved' | 'currently_reading' | 'rejected' | 'read';

// Good: Use enums for more complex cases
enum VotingPhase {
  NotStarted = 'NOT_STARTED',
  Active = 'ACTIVE',
  Closed = 'CLOSED',
  Results = 'RESULTS'
}
```

---

## Next.js Patterns

### Server Components (Default)

```typescript
// app/Vote/page.tsx
// Good: Server component for data fetching
import BookSuggestion from '@/models/BookSuggestion';
import { auth } from '@/lib/auth';

async function VotePage() {
  const session = await auth();
  const suggestions = await BookSuggestion.find({ status: 'approved' })
    .populate('suggestedBy', 'name')
    .lean();

  return (
    <div>
      <h1>Vote on Books</h1>
      <VoteList suggestions={suggestions} userId={session.user.id} />
    </div>
  );
}

export default VotePage;
```

### Client Components

```typescript
// components/VoteButton.tsx
'use client';

// Good: Use client components only when needed
// - Event handlers (onClick, onChange, etc.)
// - Hooks (useState, useEffect, etc.)
// - Browser APIs
import { useState } from 'react';

export function VoteButton({ bookId, initialVoted }: { bookId: string; initialVoted: boolean }) {
  const [hasVoted, setHasVoted] = useState(initialVoted);

  const handleVote = async () => {
    const response = await fetch('/api/suggestions', {
      method: 'PATCH',
      body: JSON.stringify({ bookId, action: hasVoted ? 'unvote' : 'vote' }),
    });

    if (response.ok) {
      setHasVoted(!hasVoted);
    }
  };

  return (
    <button onClick={handleVote}>
      {hasVoted ? 'Remove Vote' : 'Vote'}
    </button>
  );
}
```

### API Routes

```typescript
// app/api/suggestions/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { auth } from '@/lib/auth';
import BookSuggestion from '@/models/BookSuggestion';
import { suggestionSchema } from '@/lib/validations/suggestions';

// Good: Type-safe API routes with validation
export async function POST(request: NextRequest) {
  try {
    const session = await auth();

    if (!session?.user) {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 401 }
      );
    }

    const body = await request.json();

    // Validate with Zod
    const validatedData = suggestionSchema.parse(body);

    const newSuggestion = await BookSuggestion.create({
      ...validatedData,
      suggestedBy: session.user.id,
      votes: [],
      status: 'pending',
    });

    return NextResponse.json(
      { data: newSuggestion },
      { status: 201 }
    );
  } catch (error) {
    if (error instanceof z.ZodError) {
      return NextResponse.json(
        { error: 'Validation failed', details: error.errors },
        { status: 400 }
      );
    }

    return NextResponse.json(
      { error: 'Failed to create suggestion' },
      { status: 500 }
    );
  }
}
```

### Loading States

```typescript
// app/Vote/loading.tsx
export default function Loading() {
  return (
    <div className="loading-container">
      <div className="spinner" aria-label="Loading book suggestions" />
    </div>
  );
}
```

### Error Handling

```typescript
// app/Vote/error.tsx
'use client';

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  return (
    <div role="alert" className="error-container">
      <h2>Something went wrong loading the voting page!</h2>
      <button onClick={reset}>Try again</button>
    </div>
  );
}
```

### Metadata

```typescript
// app/Vote/page.tsx
import { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'Vote on Books - Barnfria Bokklubben',
  description: 'Vote on book suggestions for our next book club meeting',
};
```

---

## Styling: Tailwind CSS & CSS Variables

### CSS Variables (Brand Colors)

```css
/* src/app/globals.css */
:root {
  /* Base Colors */
  --background: #ffffff;
  --foreground: #171717;

  /* Brand Colors - Sage Green Palette */
  --primary-bg: #94b1aa;
  --secondary-bg: #568b7f;

  /* Typography Colors */
  --primary-text: #1A1A1A; /* Onyx for strong headings */
  --secondary-text: #2E2E2E; /* Dark Charcoal for comfortable reading */
  --color-muted: #4A4A4A;

  /* Border & Form Colors */
  --primary-border: #94b1aa;
  --secondary-border: #568b7f;
  --focus-ring: #568b7f;

  /* Link Colors - WCAG AAA Compliant (7:1+ contrast on white) */
  --link-color: #2d5a4f; /* 7.2:1 contrast */
  --link-hover: #1f3d36; /* 10.5:1 contrast */

  /* Button Colors - WCAG Compliant */
  --button-primary-bg: #2d5a4f; /* 7.8:1 with white text */
  --button-primary-hover: #1f3d36; /* 10.5:1 */
  --button-primary-text: #ffffff;
  --button-secondary-bg: #ffffff;
  --button-secondary-border: #568b7f;
  --button-secondary-text: #2d5a4f;
  --button-secondary-hover-bg: #2d5a4f;
  --button-secondary-hover-text: #ffffff;

  /* Action Colors - WCAG AA Compliant (4.5:1+ contrast on white) */
  --action-success: #166534; /* green-800 - 5.1:1 contrast */
  --action-success-hover: #14532d; /* green-900 - 7.4:1 contrast */
  --action-success-bg: #166534;
  --action-success-bg-hover: #14532d;

  --action-danger: #991b1b; /* red-800 - 6.1:1 contrast */
  --action-danger-hover: #7f1d1d; /* red-900 - 8.1:1 contrast */
  --action-danger-bg: #991b1b;
  --action-danger-bg-hover: #7f1d1d;

  --action-warning: #B45309; /* amber-700 - 4.8:1 contrast */
  --action-warning-hover: #92400e; /* amber-800 - 6.3:1 contrast */
  --action-warning-bg: #B45309;
  --action-warning-bg-hover: #92400e;

  /* Fonts */
  --font-newyorker: 'NewYorker', Georgia, serif;
  /* --font-heading and --font-body defined by Next.js font loader in layout.tsx */

  /* StatCard colors */
  --statcard-bg: #2d5a4f;
  --statcard-text: #ffffff;
}
```

### Tailwind Configuration

```javascript
// tailwind.config.js
const tailwindConfig = {
  content: ['./src/**/*.{js,ts,jsx,tsx,css}'],
  theme: {
    extend: {
      colors: {
        background: 'var(--background)',
        foreground: 'var(--foreground)',
        'primary-bg': 'var(--primary-bg)',
        'secondary-bg': 'var(--secondary-bg)',
        // ... all other CSS variables mapped
      },
      fontFamily: {
        newyorker: ['NewYorker', 'Georgia', 'serif'],
        sans: ['system-ui', '-apple-system', 'sans-serif'],
        mono: ['Courier New', 'monospace'],
      },
    },
  },
  plugins: [],
};

export default tailwindConfig;
```

### Using Tailwind with CSS Variables

```typescript
// Good: Combine Tailwind utilities with CSS variables
<button className="bg-[var(--button-primary-bg)] hover:bg-[var(--button-primary-hover)] text-white px-4 py-2 rounded-lg">
  Click me
</button>

// Good: Use mapped Tailwind classes
<button className="bg-primary-bg hover:bg-secondary-bg text-white px-4 py-2 rounded-lg">
  Click me
</button>

// Good: Responsive design
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  {items.map(item => <Card key={item.id} {...item} />)}
</div>
```

### Class Organization

```typescript
// Good: Organize classes logically
<button className={`
  // Layout
  flex items-center justify-center
  // Spacing
  px-4 py-2
  // Typography
  text-base font-medium
  // Colors
  bg-[var(--button-primary-bg)] text-white
  // Borders
  rounded-lg border-2 border-[var(--button-primary-bg)]
  // States
  hover:bg-[var(--button-primary-hover)] hover:border-[var(--button-primary-hover)]
  focus:outline-2 focus:outline-offset-2
  disabled:opacity-50 disabled:cursor-not-allowed
  // Transitions
  transition-all duration-300
`}>
  Submit
</button>
```

---

## Component Patterns

### Button Component

```typescript
// src/components/Button.tsx
type ButtonVariant = 'primary' | 'secondary' | 'outline' | 'ghost';
type ButtonSize = 'sm' | 'md' | 'lg';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: ButtonVariant;
  size?: ButtonSize;
  children: ReactNode;
  fullWidth?: boolean;
}

export function Button({
  variant = 'primary',
  size = 'md',
  children,
  fullWidth = false,
  className = '',
  disabled,
  ...props
}: ButtonProps) {
  const baseStyles = 'font-medium rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed';

  const variantStyles = {
    primary: `
      bg-[var(--button-primary-bg)]
      text-[var(--button-primary-text)]
      hover:bg-[var(--button-primary-hover)]
      border-2 border-[var(--button-primary-bg)]
    `,
    secondary: `
      bg-[var(--button-secondary-bg)]
      text-[var(--button-secondary-text)]
      hover:bg-[var(--button-secondary-hover-bg)]
      hover:text-[var(--button-secondary-hover-text)]
      border-2 border-[var(--button-secondary-border)]
    `,
    outline: `
      border-2 border-[var(--button-secondary-border)]
      bg-white
      text-[var(--button-secondary-text)]
      hover:bg-[var(--button-secondary-hover-bg)]
      hover:text-[var(--button-secondary-hover-text)]
    `,
    ghost: `
      bg-transparent
      text-[var(--button-secondary-text)]
      hover:bg-gray-100
      border-2 border-transparent
    `,
  };

  const sizeStyles = {
    sm: 'px-3 py-1.5 text-sm',
    md: 'px-4 py-2 text-base',
    lg: 'px-6 py-3 text-lg',
  };

  return (
    <button
      className={`${baseStyles} ${variantStyles[variant]} ${sizeStyles[size]} ${fullWidth ? 'w-full' : ''} ${className}`.trim()}
      style={{ outlineColor: 'var(--focus-ring)' }}
      disabled={disabled}
      {...props}
    >
      {children}
    </button>
  );
}
```

### ActionButton Component (Admin Actions)

```typescript
// src/components/ActionButton.tsx
type ActionButtonVariant = 'success' | 'danger' | 'warning';

interface ActionButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant: ActionButtonVariant;
  size?: 'sm' | 'md' | 'lg';
  children: ReactNode;
  fullWidth?: boolean;
}

/**
 * ActionButton - Specialized button for approve/reject admin actions
 * Uses WCAG AA compliant green/red/amber colors
 */
export function ActionButton({
  variant,
  size = 'md',
  children,
  fullWidth = false,
  ...props
}: ActionButtonProps) {
  const variantStyles = {
    success: `
      bg-[var(--action-success-bg)] text-white
      hover:bg-white hover:text-[var(--action-success)]
      border-2 border-[var(--action-success-bg)]
    `,
    danger: `
      bg-[var(--action-danger-bg)] text-white
      hover:bg-white hover:text-[var(--action-danger)]
      border-2 border-[var(--action-danger-bg)]
    `,
    warning: `
      bg-[var(--action-warning-bg)] text-white
      hover:bg-white hover:text-[var(--action-warning)]
      border-2 border-[var(--action-warning-bg)]
    `,
  };

  return (
    <button
      className={`font-medium rounded-md transition-all duration-300 ${variantStyles[variant]} ...`}
      {...props}
    >
      {children}
    </button>
  );
}
```

### Authorization Wrapper Components

```typescript
// src/components/AdminOnly.tsx
'use client';

import { useSession } from 'next-auth/react';

export function AdminOnly({ children }: { children: React.ReactNode }) {
  const { data: session } = useSession();

  if (session?.user?.role !== 'admin') {
    return null;
  }

  return <>{children}</>;
}

// src/components/ApprovedOnly.tsx
export function ApprovedOnly({ children }: { children: React.ReactNode }) {
  const { data: session } = useSession();

  if (!session?.user?.isApproved) {
    return null;
  }

  return <>{children}</>;
}

// Usage
<ApprovedOnly>
  <Button onClick={handleSuggestBook}>Suggest a Book</Button>
</ApprovedOnly>

<AdminOnly>
  <button onClick={handleDeleteUser}>Delete User</button>
</AdminOnly>
```

---

## WCAG Accessibility Standards

This project follows **WCAG 2.1 Level AA compliance** standards, with many AAA-level features.

### Color Contrast

All colors have been tested for WCAG compliance:
- **Links:** 7:1 contrast ratio (AAA level)
- **Buttons:** 7.8:1 contrast ratio (AAA level)
- **Action buttons:** 4.5:1 minimum (AA level)
- **Body text:** High contrast for readability

### Keyboard Navigation

```typescript
// Good: Keyboard accessible components
<button
  onClick={handleClick}
  onKeyDown={(e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      handleClick();
    }
  }}
  aria-label="Vote for this book"
>
  Vote
</button>

// Good: Focus indicators
button:focus-visible {
  outline: 2px solid var(--focus-ring);
  outline-offset: 2px;
}
```

### Semantic HTML

```typescript
// Good: Use semantic elements
<nav aria-label="Main navigation">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/Vote">Vote</a></li>
  </ul>
</nav>

<main>
  <h1>Book Suggestions</h1>
  <article>
    <h2>Book Title</h2>
    <p>Description...</p>
  </article>
</main>

// Bad: Div soup
<div className="nav">
  <div className="link">Home</div>
</div>
```

### ARIA Attributes

```typescript
// Good: Descriptive ARIA labels
<button aria-label="Close modal" onClick={handleClose}>
  ×
</button>

<div role="alert" aria-live="polite">
  Book suggestion submitted successfully!
</div>

<input
  type="text"
  id="book-title"
  aria-required="true"
  aria-describedby="title-help"
/>
<span id="title-help">Enter the book's full title</span>
```

### Image Alt Text

```typescript
// Good: Descriptive alt text
<img
  src={book.coverImage}
  alt={`Cover of ${book.title} by ${book.author}`}
/>

// Good: Empty alt for decorative images
<img src="/decorative-pattern.svg" alt="" />
```

### Touch Target Size (WCAG 2.5.5)

All interactive elements meet **WCAG 2.1 Level AAA** standards (44x44px minimum):

```typescript
// Good: Sufficient touch target size
<button
  onClick={handleExpand}
  className="text-sm text-[var(--link-color)] hover:text-[var(--link-hover)] hover:underline mt-1 py-2 focus:outline-2 focus:outline-offset-2 inline-block min-h-[44px] min-w-[44px]"
  style={{ outlineColor: 'var(--focus-ring)' }}
  aria-expanded={isExpanded}
>
  {isExpanded ? 'Visa mindre' : `Läs mer om ${bookTitle}`}
</button>

// Key classes for touch targets:
// - py-2: Vertical padding
// - min-h-[44px]: Minimum height (WCAG AAA)
// - min-w-[44px]: Minimum width (WCAG AAA)
// - inline-block: Ensures min dimensions are respected
```

**Touch Target Checklist:**
- [ ] All buttons have minimum 44x44px touch area
- [ ] Interactive elements have adequate spacing (at least 8px between targets)
- [ ] Text links have sufficient padding or are within larger clickable areas
- [ ] Icon-only buttons meet size requirements

---

## Performance Optimization

### Code Splitting

```typescript
// Good: Dynamic imports for large components
import dynamic from 'next/dynamic';

const BookEditor = dynamic(() => import('@/components/BookEditor'), {
  loading: () => <LoadingSkeleton />,
  ssr: false, // Disable SSR if needed for client-only features
});
```

### Memoization

```typescript
// Good: Memoize expensive calculations
const sortedBooks = useMemo(() => {
  return books.sort((a, b) => b.votes.length - a.votes.length);
}, [books]);

// Good: Memoize callback functions passed to children
const handleVote = useCallback((bookId: string) => {
  setVotes(prev => ({ ...prev, [bookId]: (prev[bookId] || 0) + 1 }));
}, []);

// Good: Memoize components when appropriate
const BookCard = memo(function BookCard({ book }: { book: IBookSuggestion }) {
  return (
    <div className="book-card">
      <h3>{book.title}</h3>
      <p>{book.author}</p>
    </div>
  );
});
```

### Database Queries

```typescript
// Good: Efficient queries with Mongoose
const suggestions = await BookSuggestion.find({ status: 'approved' })
  .select('title author votes coverImage') // Only fetch needed fields
  .populate('suggestedBy', 'name') // Populate only needed fields
  .limit(20)
  .lean(); // Convert to plain JS objects for better performance

// Good: Use indexes (defined in models)
BookSuggestionSchema.index({ status: 1 });
BookSuggestionSchema.index({ votes: 1 });
BookSuggestionSchema.index({ createdAt: -1 });
```

### Image Optimization

```typescript
// Good: Use Next.js Image component
import Image from 'next/image';

<Image
  src={book.coverImage}
  alt={`Cover of ${book.title}`}
  width={300}
  height={450}
  placeholder="blur"
  blurDataURL="/book-placeholder.jpg"
/>
```

---

## Environment Variables

Required environment variables in `.env.local`:

```bash
# MongoDB
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/bookclub?retryWrites=true&w=majority

# NextAuth.js
AUTH_URL=http://localhost:3000
NEXTAUTH_URL=http://localhost:3000
AUTH_SECRET=your-secret-key-here

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Google Books API
GOOGLE_BOOKS_API_KEY=your-google-books-api-key

# Admin Configuration
# SECURITY: Only used for initial setup when no admins exist
# After first admin is created, this variable is ignored
ADMIN_EMAIL=admin@example.com
```

**Security Note**: `ADMIN_EMAIL` is only active when no admin users exist in the database. Once the first admin is created, this environment variable no longer auto-promotes users to admin. See README.md section 7 for details.

---

## Deployment

### Netlify Configuration

```toml
# netlify.toml
[build]
  base = "frontend"
  command = "npm run build"
  publish = ".next"

[[plugins]]
  package = "@netlify/plugin-nextjs"
```

### Environment Variables on Netlify

Set all environment variables from `.env.local` in Netlify dashboard under:
**Site settings → Environment variables**

---

## Quick Reference Checklist

### Before Committing Code

- [ ] TypeScript has no errors (`npm run build`)
- [ ] All interactive elements are keyboard accessible
- [ ] Touch targets meet WCAG AAA standards (44x44px minimum)
- [ ] Color contrast meets WCAG AA standards (4.5:1 for text)
- [ ] Images have appropriate alt text
- [ ] Forms have associated labels
- [ ] Focus indicators are visible
- [ ] ARIA attributes are used correctly (when needed)
- [ ] Semantic HTML is used
- [ ] No console errors or warnings
- [ ] Components are properly typed
- [ ] CSS variables are used consistently
- [ ] Responsive design works on mobile/tablet/desktop
- [ ] Authorization checks are in place for protected content

### Accessibility Quick Wins

1. Use semantic HTML (`<button>`, `<nav>`, `<main>`, `<article>`)
2. Always include `lang="en"` attribute on `<html>` (or `lang="sv"` for Swedish)
3. Ensure proper heading hierarchy (h1 → h2 → h3)
4. Add `alt` text to images (empty for decorative)
5. Associate labels with form inputs
6. Provide focus indicators (automatically handled by CSS variables)
7. Test with keyboard only (Tab, Enter, Space, Escape)
8. Check color contrast with WebAIM Contrast Checker
9. Add loading states with `aria-live` or `aria-busy`
10. Use `aria-label` for icon-only buttons

---

## Resources

- [Next.js 15 Documentation](https://nextjs.org/docs)
- [React 19 Documentation](https://react.dev)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [NextAuth.js Documentation](https://authjs.dev/)
- [Mongoose Documentation](https://mongoosejs.com/docs/)
- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [MDN Web Accessibility](https://developer.mozilla.org/en-US/docs/Web/Accessibility)
- [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)
- [Google Books API Documentation](https://developers.google.com/books)
